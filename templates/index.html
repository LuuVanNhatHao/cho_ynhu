{% extends "base.html" %}

{% block title %}Dashboard - WorkWell Analytics{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Alert Container -->
    <div id="alert-container"></div>
    
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-4 fw-bold text-primary">
                <i class="fas fa-tachometer-alt"></i> Executive Dashboard
            </h1>
            <p class="lead text-muted">Real-time insights into workforce well-being and productivity</p>
        </div>
    </div>
    
    <!-- Key Metrics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stat-card">
                <div class="stat-number text-primary">{{ "{:,}".format(stats.total_records) }}</div>
                <div class="stat-label">Total Employees</div>
                <i class="fas fa-users fa-2x text-muted mt-2"></i>
            </div>
        </div>
        
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stat-card">
                <div class="stat-number text-success">{{ stats.regions }}</div>
                <div class="stat-label">Regions</div>
                <i class="fas fa-globe fa-2x text-muted mt-2"></i>
            </div>
        </div>
        
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stat-card">
                <div class="stat-number text-info">{{ "{:.1f}".format(stats.avg_hours) }}</div>
                <div class="stat-label">Avg Hours/Week</div>
                <i class="fas fa-clock fa-2x text-muted mt-2"></i>
            </div>
        </div>
        
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stat-card">
                <div class="stat-number text-danger">{{ "{:.1f}%".format(stats.burnout_rate) }}</div>
                <div class="stat-label">High Burnout Rate</div>
                <i class="fas fa-fire fa-2x text-muted mt-2"></i>
            </div>
        </div>
    </div>
    
    <!-- Main Charts Row -->
    <div class="row mb-4">
        <!-- Work-Life Balance Overview -->
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-balance-scale"></i> Work-Life Balance Overview
                </div>
                <div class="card-body">
                    <div id="wlb-overview-chart" class="chart-container"></div>
                </div>
            </div>
        </div>
        
        <!-- Quick Stats -->
        <div class="col-lg-4 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-pie"></i> Quick Insights
                </div>
                <div class="card-body">
                    <div id="quick-insights-chart" style="height: 400px;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Secondary Charts Row -->
    <div class="row mb-4">
        <!-- Burnout Trends -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-fire-extinguisher"></i> Burnout Analysis
                </div>
                <div class="card-body">
                    <div id="burnout-trends-chart" class="chart-container"></div>
                </div>
            </div>
        </div>
        
        <!-- Department Comparison -->
        <div class="col-lg-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-building"></i> Department Comparison
                </div>
                <div class="card-body">
                    <div id="department-chart" class="chart-container"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Action Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                    <h5 class="card-title">Explore Data</h5>
                    <p class="card-text">Deep dive into employee demographics and work patterns</p>
                    <a href="/eda" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i> View EDA
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-success">
                <div class="card-body text-center">
                    <i class="fas fa-microscope fa-3x text-success mb-3"></i>
                    <h5 class="card-title">Test Hypotheses</h5>
                    <p class="card-text">Statistical analysis of workplace factors</p>
                    <a href="/hypothesis" class="btn btn-success">
                        <i class="fas fa-arrow-right"></i> Run Tests
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card border-info">
                <div class="card-body text-center">
                    <i class="fas fa-users-cog fa-3x text-info mb-3"></i>
                    <h5 class="card-title">Discover Personas</h5>
                    <p class="card-text">Employee clustering and persona analysis</p>
                    <a href="/clusters" class="btn btn-info">
                        <i class="fas fa-arrow-right"></i> View Personas
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Key Findings Section -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <i class="fas fa-lightbulb"></i> Key Findings & Recommendations
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fw-bold text-danger">
                                <i class="fas fa-exclamation-triangle"></i> Areas of Concern
                            </h6>
                            <ul id="concerns-list">
                                <li>High burnout rate exceeding industry standards</li>
                                <li>Significant work-life balance challenges in certain departments</li>
                                <li>Increasing social isolation scores among remote workers</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-success">
                                <i class="fas fa-check-circle"></i> Positive Trends
                            </h6>
                            <ul id="positives-list">
                                <li>Flexible work arrangements showing positive impact</li>
                                <li>Mental health awareness programs gaining traction</li>
                                <li>Cross-generational collaboration improving</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Load main charts
    loadWLBOverview();
    loadQuickInsights();
    loadBurnoutTrends();
    loadDepartmentComparison();
    
    // Refresh data every 5 minutes
    setInterval(function() {
        refreshDashboard();
    }, 300000);
});

function loadWLBOverview() {
    fetch('/api/eda/work_arrangement')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('wlb-overview-chart', data.data, data.layout, {responsive: true});
        })
        .catch(error => console.error('Error:', error));
}

function loadQuickInsights() {
    fetch('/api/eda/demographics')
        .then(response => response.json())
        .then(data => {
            // Extract pie chart from demographics
            if (data.data && data.data.length > 1) {
                Plotly.newPlot('quick-insights-chart', [data.data[1]], 
                    {title: 'Gender Distribution', height: 400}, 
                    {responsive: true});
            }
        })
        .catch(error => console.error('Error:', error));
}

function loadBurnoutTrends() {
    fetch('/api/eda/burnout_distribution')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('burnout-trends-chart', data.data, data.layout, {responsive: true});
        })
        .catch(error => console.error('Error:', error));
}

function loadDepartmentComparison() {
    fetch('/api/eda/industry_comparison')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('department-chart', data.data, data.layout, {responsive: true});
        })
        .catch(error => console.error('Error:', error));
}

function refreshDashboard() {
    showAlert('Refreshing dashboard data...', 'info');
    loadWLBOverview();
    loadQuickInsights();
    loadBurnoutTrends();
    loadDepartmentComparison();
}

// Export functionality
function exportDashboard() {
    fetch('/api/export/eda_report')
        .then(response => response.json())
        .then(data => {
            // Convert to CSV or download
            console.log('Export data:', data);
            showAlert('Report exported successfully!', 'success');
        })
        .catch(error => {
            showAlert('Export failed: ' + error, 'danger');
        });
}
</script>
{% endblock %}